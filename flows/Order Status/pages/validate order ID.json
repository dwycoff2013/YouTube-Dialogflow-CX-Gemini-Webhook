{
  "name": "b3a6822b-7a46-400b-a50b-e386ca2d915c",
  "displayName": "validate order ID",
  "form": {
  
  },
  "entryFulfillment": {
    "setParameterActions": [ {
      "parameter": "$flow.order_id",
      "value": "$session.params.all_recent_order_id[$sys.func.TO_NUMBER($flow.order_id_counter)]"
    }, {
      "parameter": "$flow.last_five_digit_of_order_id",
      "value": "$sys.func.MID($flow.order_id,$sys.func.MINUS($sys.func.LEN($flow.order_id),4),5)"
    }, {
      "parameter": "$flow.order_id_counter",
      "value": "$sys.func.ADD($flow.order_id_counter,1)"
    } ]
  },
  "transitionRoutes": [ {
    "condition": "$flow.last_five_digit_of_order_id = $flow.user_provided_last_five_digit_of_order_id AND $flow.order_id_counter \u003c= $sys.func.COUNT($session.params.all_recent_order_id)",
    "triggerFulfillment": {
      "setParameterActions": [ {
        "parameter": "$flow.duplicate_order_id",
        "value": "$sys.func.APPEND($flow.duplicate_order_id,$flow.order_id)"
      } ]
    },
    "targetPage": "Current Page",
    "name": "223feed0-81b6-4714-a7bf-591938331be9"
  }, {
    "condition": "$flow.last_five_digit_of_order_id != $flow.user_provided_last_five_digit_of_order_id AND $flow.order_id_counter \u003c= $sys.func.COUNT($session.params.all_recent_order_id)",
    "triggerFulfillment": {
    
    },
    "targetPage": "Current Page",
    "name": "c8597511-3fe5-4048-95ae-b4422af45572"
  }, {
    "condition": "$sys.func.COUNT($flow.duplicate_order_id) = 0 AND $flow.order_id_counter \u003e $sys.func.COUNT($session.params.all_recent_order_id) AND $flow.retry_another_order_id_counter \u003c $flow.max_retry_another_order_id",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Sorry, you have entered an invalid order number." ]
        },
        "languageCode": "en"
      } ],
      "setParameterActions": [ {
        "parameter": "$flow.retry_another_order_id_counter",
        "value": "$sys.func.ADD($flow.retry_another_order_id_counter,1)"
      }, {
        "parameter": "$flow.order_id_counter",
        "value": 0
      }, {
        "parameter": "user_provided_last_five_digit_of_order_id",
        "value": null
      } ]
    },
    "targetPage": "\u003e collect order ID",
    "name": "ea7667f9-6aee-4fa3-aa3f-7894d070d34d"
  }, {
    "condition": "$sys.func.COUNT($flow.duplicate_order_id) \u003e 0 AND $flow.order_id_counter \u003e= $sys.func.COUNT($session.params.all_recent_order_id)",
    "triggerFulfillment": {
    
    },
    "targetPage": "check duplicate order ID exists",
    "name": "86e53103-8f31-476a-b918-ef37d3dc1c1c"
  }, {
    "condition": "$flow.retry_another_order_id_counter = $flow.max_retry_another_order_id",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Sorry, you exceeded the maximum number of attempts of validation due to incorrect order ID details." ]
        },
        "languageCode": "en"
      } ]
    },
    "targetPage": "end failure",
    "name": "4b6a6a57-8ff3-4617-81c3-195f01d2007e"
  } ]
}
